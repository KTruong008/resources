var krelloApp=angular.module("krelloApp",["ngResource","ngRoute"]);krelloApp.controller("boardController",["$scope","$resource","$location","$http","$routeParams","BoardManipulator","Requests",function(r,e,t,a,s,o,d){r.listRedirect=function(r){t.path("/lists/"+r.boardID)},r.user=d.User.get(),r.boards=o.boards,r.allBoards=d.userBoards.get(),r.deleteBoard=function(r){o.deleteBoard(r)},r.addBoard=function(e,t){o.addBoard(e,t),r.createBoardMode=!r.createBoardMode,r.boardDetails={}}}]),krelloApp.controller("listController",["$scope","$resource","$location","$http","$routeParams","Requests","ListManipulator","CardManipulator",function(r,e,t,a,s,o,d,i){r.boardIDParam=s.boardID,r.lists=o.userBoards.get({id:r.boardIDParam}),r.listDetails={},r.cardDetails={},r.deleteList=function(r,e,t){d.deleteList(r,e,t)},r.addList=function(e,t,a){d.addList(e,t,a),r.createListMode=!r.createListMode,r.listDetails={}},r.deleteCard=function(r,e,t,a,s){i.deleteCard(r,e,t,a)},r.addCard=function(e,t,a,s){i.addCard(e,t,a,s),r.createCardMode=!r.createCardMode,r.cardDetails={}}}]),krelloApp.config(function(r){r.when("/",{templateUrl:"static/scripts/pages/boards.html",controller:"boardController"}).when("/lists/:boardID",{templateUrl:"static/scripts/pages/lists.html",controller:"listController"})}),krelloApp.factory("Requests",["$resource",function(r){return{User:r("/api/user",{},{}),userLists:r("/api/boards/lists/:cards/:boardID/:listID/:cardID",{},{}),userBoards:r("/api/boards/:id",{},{get:{method:"GET",isArray:!0}})}}]),krelloApp.service("BoardManipulator",["$resource","Requests",function(r,e){self=this,this.boards=e.userBoards.get(),this.addBoard=function(r,t){var a={title:t.title,boardID:Math.floor(1e5*Math.random()+1),lists:[]};r.push(a);var s=new e.userBoards(a);s.$save()},this.deleteBoard=function(r){var t=new e.userBoards;pluckedBoard=_.find(self.boards,function(e){return parseFloat(r.boardID)===parseFloat(e.boardID)}),self.boards.splice(self.boards.indexOf(pluckedBoard),1),t.$delete({id:r.boardID})}}]),krelloApp.service("ListManipulator",["$resource","Requests",function(r,e){this.addList=function(r,t,a){var s={title:a.title,listID:Math.floor(1e5*Math.random()+1),cards:[]};r.push(s);var o=new e.userLists(s);o.$save({boardID:t})},this.deleteList=function(r,t,a){var s=_.find(t,function(e){return parseFloat(r.listID)===parseFloat(e.listID)});t.splice(t.indexOf(s),1);var o=new e.userLists;o.$delete({boardID:a,listID:r.listID})}}]),krelloApp.service("CardManipulator",["$resource","Requests",function(r,e){this.addCard=function(r,t,a,s){var o={title:s.title,description:s.description,cardID:Math.floor(1e5*Math.random()+1)};r.cards.push(o);var d=new e.userLists(o);d.$save({cards:"cards",boardID:a,listID:r.listID})},this.deleteCard=function(r,t,a,s){var o=new e.userLists;_.find(a,function(r){return parseFloat(t.listID)===parseFloat(r.listID)});cards=t.cards,r=_.find(cards,function(e){return parseFloat(e.cardID)===parseFloat(r.cardID)}),cards.splice(_.indexOf(cards,r),1),o.$delete({cards:"cards",boardID:s,listID:t.listID,cardID:r.cardID})}}]);